language: node_js
node_js:
  - "7"

os:
  - linux
#  - osx # removed OSX because macOS builds on travisci are becoming unstable
dist: trusty # to use Ubuntu 14.04
#osx_image: xcode8.3 # to use macOS Sierra 10.12
sudo: false

git:
  depth: 3

branches:
  except:
    - v4 # skip experimental v4 branch

env:
  global:
    # CODECLIMATE
    - secure: Rov9tYDaMYPBUeWDtD43S9h3llaljjMB0Khdi7P+kbkYOUPCm+Ol1Sr7nS+lwOQpF/3T1kva2OQ/LWkOM8kSng86EkMviEGQXpdlGRxP9clo8qmxyfbcKID5Q/a29kOIbkbbhx9cGFoepEjo+5T+Ya7GbbXIyMt1PNTCy5eLXnfU8BE/G3Ib8eVNBxGANiOuBTkKfzTyajH+pcsj0Wvr2Po/PjSIwYk6EfCzsYWbLDxjo86w7hD7F5OtjxPJTsYz3K1OwdneaUJ3bYLrGqpNewIfR4gASNTB4fBio0ZdBZ44UulKo6rO7tUMMQdCGm9+c54XeVGigJE9uhz8Fcim3FpfY9jraT9dhp5xPgvDl0OC/NVvHAGumak67X4Vkui5dAGGqbfNGfnWRvzkar/Xj3QpO7UJ0VEp2nFmZqgwE9CHhi+xMAh2+C5aoVsvtdb8LiACnN0YOfrMQvkoX2JGoGrLuJGJSTC3fRiLFIvWnX73L7+XKlrRUceoroyQ6WXEPkUbrtVtTN/yE0CVJmpVS1oE4Nre3zvOQAtIxGJWbk2rYTQ95C7cixAeo7ucFnX3J6YrSiTm0Ny+smdgv2KkXX8Q+UY0JG10BN3tHc67gqpvsaAPQaPGq4KF/jngE4a5H+skzpTnPRU0sozY4uNDXwGZmo4va03NFk6XVMk9rzo=
    # COVERALLS
    - secure: EtPvv9j3yZ8UjlloTx/5UIeRTIc4lSBirjhEKrOEDz5AVTBy71ndwOPo/pOg9sG6NclaXOZpYeVxw5LtsoX9fNW7fQZzkkENfYK7S0TgNrcAYfoAdkvV7IdjU0UkQG7hzSqT14Ad+//trfA/ExERHP/yQ6UhJ/wZRx/z4jQORgC/CtoB9nPugO04Wl+nzL9hS68Eh6NdVwEBNVNDjaNgpONfes8n5cNsGK90O9IVwGqleLsJ+nk3ZIit4zWHNkyxN22an0s8Cql/l+WlQlr2LlJG1iYVFyQALVqgcSOn3LQBDWW2FDEFZO40zKPKwvymTFezP+UAOupBtHTWnF2he5fNgPDYpc27QyKrxp7yfKFRtwSlAY2ONTNtzQ/eJmuSF8QKDm5oh9za9+SnxRlbNhG0hcYtIBjYVp2E8ocVqLd2LWanfFDbUI5Qij6aZTyRXsHGqgY6gpAo6zAToOfSXCxFXW8Y9p4KQszcxSenvCHxn9H08A8HJipsN3PJAHex/ZD4Kw6SzerC0XKvnhhg2jmasamjlLy4mlY4xlIkGns7PF+3818nlw9Naans83+fB8ngy+GbHC1vOoKO0QzE0ZorEFEt9t6wADFdOnZvFZ09MHz90bOUryUC6OT2JO44t9ES66oLE+8e9yheCgKyTpnEHgfvSaOGqEmzMGoCTgY=
    # GOOGLE_CLIENT_SECRET
    - secure: XLfh8kRq6E5nZN6lggCn6R/ugEcHwzSMjs7sUuZnJgMrq7vBCZhzGX6wJ0HB4No/GsbuRiWkp3FyIzhJc8b2XNUqFFqWnKnwnzT5rcrjoXGnoUapSqkFV1ditmr+bFop1KP7PtuVdkMt9CwPaLkRby3wmfkgH6GGQBDFiWOqfhrjUV3D54V1x+cgC7J8Gg5oWoJwAP4pgvSm+JjFi7hgXndgx3b22avD/LPWcMiLCvmbt4ciSKcicQm50fAvBTGKcTESkhKR2LKZIOlc6rFtF/N4x910WA1P5Hj+zKJDOY/NvdtRdftSD36pjOm6XrDyINh6yoTpoHscFMPUG3DmpHngaisRAgHoIgBIXwf6/AhWLJoyltUFtlHbQ822xC11Q3wTgSGIYccOHlvYOy7t6JOOmJbTGwZJHgWMokmbzmv3FN4uPjm3ZwtAc51vp6AVAo9TbEOYoioVkI8x9GKFefXYNFfPTFiVLD3UCvJWFF5Y3A/MTZdq+ZJsAKQkGcm49CNTC31JLfM94ZDPQjVIIiW0TXIBlnIzwUSVamH8OS/NjBV4UQKmiUP4ovQgmkfinC1UkceKjCg1nzx/JUTaQo1wepy+nP4i4JwfBIRPpPeXKBd47den8ijaLG4Im6es7ZBvnbaUMjMB8HO2ZSVINa21medcYj1GmyottQKLrwM=
    # FACEBOOK_APP_SECRET
    - secure: Jd2GZo3iCbylESMIwgLSfq+oCtsolbazfkCAsUmjtIVVzHjizl4k9sfHDOFR9TbjKaxuelwokCIStDvnKHVVSVLSZapvGlwgy3iWX4jsVcKi7hWgrB/v1v/Fw680n0dH0BxXNacrkREVnwqQpgkRSMPoG/lsHkz1mPauNczidzGzMWxTANypyjYzx9Rg5wk2MqRMmOleIt3G7bwWsLFpXTns0CtNo/gglCz4BVFws/CnYtQZ+lb3pssmVyhdQnfObQxkoLOebMElTZkcyTJBoto843QGJvJGwjJ1V8494JDnnPmyFUtLpd0ueyhB/clQZY5ZiouulOVCUYIf7Qjwldq/x2eiZyxqHsTVptMFOvWW4PyW5ZhpUbA0fEck7Q4aBry33VozNkRvglifnFExB2uiBcx/LNAJNY+E7/tRHWKH01DtRrozMBOxlbCWoI5w4CUNoknhnQkGCkG0IokPZQC9AZLeJUSleCuEnzBUyTK3YGsGqjYHA7BKqiVO9o+4x6+TBGN8OyNpBXvlRkxZXfW/4nQwMe1218mYjv6JTztN9lVozDmyfQcSNCzf+pp2qldkYw1/YC7nl8vWQPOLj32l9dHdsQxDJek7elNOv/a/GjEaj03ItgjZzykQ46NZE19a6yXZCRVBgLaCuk4o8CWx6gyoogCuCDTG75emDdk=
    # GITHUB_CLIENT_SECRET
    - secure: BVDW1m9Didg56Cp+kigZLCisLGPBBWEm4P7Goq2j5iz/b6C/2YVM+CJVetMOgjYxY66bifXzUR6gcr4DYTLWRtP3C2fnBZXphJXFjI3R04uxSCdukh7Uc0zqDfPvXzlXh40QD3647AuUCYZmgePe2mjrd4gHbE2VGyOTa/ZMizxrJPnCKhtz6AhMaZHHSX5Pjv2GRvoXa3bLs9EtSYditJHlkIwb7MqTL54snIRmCvLXwVl2LGc9SmTMfEnYUSgWn7dbbvUi8dCW05RPQaebRutEQ9Nr616wnOOYWX4tHjq7hYO0PZCUwo8t6ZpKv5r2dXB1v5ziX1toIfiUA2qLKMFYM1Gl3Tyy1jkspRW0bq7jL/DjPElcjntpfSD6Jnmg2BlYjZdVnfw5BhWhaqz7/QByVwHh91xoqwEqQjgHBxmVE3G6gQcTJyei9Ja958Kl6VMwP/aGQu+lQemSiGq2uCNsTQfYlOUOsFCVrC+RrRj2vHRfqq3hkQdGmv1xIuF/6xmtt2xUMLujSjHocNBLxkMsTq6H6AUqLdM4flv2JdXrXK/c4hkpEOLLWwhGyjroRtYUV9RBfvL3/HDFhLdtfeCvbyO1P+RSmHT2Xilamay09swe1Z9D02GcrSS8PMxT0rRKltVLR0AKGFLkLxd6ERu/ViXydgOVsd2e1wLhDk0=
    # TWITTER_CONSUMER_SECRET
    - secure: a4l2JHHaKYeGJf+koV3D9R0YII8+MtT5cv9Tjjq1liANg2/8RNJlLCTGw/C6mwZnWw0rnC0Xqb7Qsq5RN3P1ezf6MqdQO/waROpZdD8vLUQbMi528qu9s1OZIBg4HIBWGvnD6W8OqUW9AjUPf+bzXwwojRvNgOdxHF1WvC807cWo1iW3/pbQP+U5sGMAsm0vNPzQXrVgPcCRA83UZ/yXl8GMSsppoX8/Y8rxz6IoJbWmkNO0cOc4t+1zGesPJVd7n/SpVZi9qKn+Ky2ZvoCITceA3JYOp2qZTX//m0DJWOf+aPHi4nxTlxnvdgZWjX0VF2FddUNEJOX7Ztw7p2vqsxJD9pcobrISyOe2/kbIAinRwMO5scsCoI/Vxw6iuy604pvkbMO6Hf6FTStoqHUMDUt1nkO2gMHfkbYTMuEMER/OX5hSan98Nwo5sQPf49W0ct6tA9HpRW9EcawqCW+zEZK47ZNZ5AjvlTYDyWDzkgFOpPdz45KnywILa14utfmTIhfBz6GuuFfnmc+VAbaDM0EZTZAhduOlptwMUIciBB3PEFwh/0g3WzYLdqeY0B3Qu0XZS0ML/5+yNWOwvPDeS6OxN24WjQpOD4X+Wmsj0AM7Qod3rD09efPG2kuOwe8Vck66DT/dbjCg054rwHZeKHCEyh11SfOYek9L7A867j4=
    # LINKEDIN_CLIENT_SECRET
    - secure: XQFOEJWQV9iX6SMUMdx1wK6N1RESs5ksAd0ae0zffb+yFlANwVhBAwo4jvSh0SlOEozgW31pqN6rbA6qKQf44NSk/EgLtq/CYuJqvYoOg1R8YovmTNyHIydGYgixQbyKGRmAZ3dZSnqknFSsNEfPRRR/C1KLYFV+hvqUAijdh6CrvevnLvYJeLJhhZLUZSws6Z/jxoW5/35CHH5HuTWfNH20zKDyM4QWSoQr/iOQutZa5UuCe1IUqVUP6jqRdPgFxSXT4UHsyBzieeQhof+NgmuW0zAXmei5r97mloMnfo1NEiGoZ3W7Df+Ngd2Q+/4PyfLK3iBH/gQwMRxBRa1QgYUhoPtw9YTNE/AKmtb5mELPevQgqNH1DoSCghoK638uBU3X4LYR+3i0XVK4iPRBjN8ktPcns9jc03QxtKPdU4Cx+JEmf/aU+cCYxYhoZ2AqZ1TLVAP2lJJPtE555lLGdTLOy4B+uU19G82ofJ29Tk1Yc/Kw0q4I0Dmt91u7CxQNBq24wR596VrontUhSMh2T+lZAHpXfeaWJLcBMZrYcYCr3BCWkzUyW4xwLft0mNv+abafE0N4exXuTbm1qeUx0hvlpo+i4E/LUeP9xGYBRR2DtIZFSgophFHL4LzaQg4cHXwDNSqI7A6KhUh7341/Oz/EFhrCUGF/bEZ4MTN7dcw=

services:
  - mongodb
  - redis-server

addons:
  firefox: latest
  apt:
    sources:
      - google-chrome
    packages:
      - google-chrome-stable

matrix:
  fast_finish: true

before_install:
  - source travisci/before_install.sh
install:
  - bash travisci/install.sh
after_install:
  - npm rebuild node-sass
before_script:
  - source travisci/before_script.sh # starts in the same shell
script:
  - bash travisci/script.sh
after_success:
  - source travisci/after_success.sh
after_script:
  - bash travisci/after_script.sh

cache:
  apt: true
  bundler: true
  directories:
    - node_modules